<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Smart Chinese Kids</title>
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
<link rel="stylesheet" type="text/css" href="css/styles.css">
</head>

<body>
<div class="container"> 
  <!-- ------- ------- ------- ------- ------- ------- ------- -->
  <div class="top">
    <button class="btn btn-warning btn-logout" type="button" onclick="window.location='index.html'"><span class="glyphicon glyphicon-log-out" aria-hidden="true"></span></button>
    <div class="row">
      <div class="col-md-8">
        <div class="topic"> <a class="topic-title grade-flag G1" href="lessonPanel-0-1-6.html">
          <div class="grade_C">0</div>
          <div class="grade_E">Starter</div>
          </a>
          <div class="topic-content">
            <div class="topic-text">
              <div> 我回家了 </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="bear hidden-xs hidden-sm"> <img src="images/bearHi.png"> </div>
  </div>
  <!-- ------- ------- ------- ------- ------- ------- ------- -->
  <div class="content"> 
    <!-- -->
    <div class="navigation"> </div>
    <!-- --> 
    <!-- -->
    <div class="content-header">
      <div class="stepMenu">
        <ul class="list-inline">
          <li><a href="courseText-0.html#page1"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>第1页</a></li>
          <li><a href="courseText-0.html#page2"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>第2页</a></li>
          <li><a href="courseText-0.html#page3"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>第3页</a></li>
          <li><a href="courseText-0.html#page4"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>第4页</a></li>
          <li><a href="courseText-0.html#page5"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>第5页</a></li>
          <li><a href="courseText-0.html#page6"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>第6页</a></li>
          <li><a href="courseText-0.html#page7"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>第7页</a></li>
          <li><a href="courseText-0.html#sing"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>一起唱</a></li>
        </ul>
      </div>
    </div>
    <!-- --> 
    <!-- -->
    <div class="content-body" style="background-image: url(images/photo/10101-bg.jpg);">
      <div class="artical textSection">
        <div class="pageBlock" id="page1"> 
          <!-- -->
          <div class="dialog-p">
            <div class="dialog-figure"></div>
            <div class="dialog-content">
              <div class="dialog-content-sentence">
                <div class="dialog-content-text" onClick="PLAY(this, 'https://kids.smartchinese.org/temp/001 我回家了_03_跨頁.mp3');">
                  <button class="btn-play-small"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>PLAY</button>
                  <ruby><rb>小</rb><rt>Xiǎo</rt></ruby>
                  <ruby><rb>鳥</rb><rt>niǎo</rt></ruby>
                  <ruby><rb>飛</rb><rt>fēi</rt></ruby>
                  <ruby><rb>呀</rb><rt>ya</rt></ruby>
                  <ruby><rb>飛</rb><rt>fēi</rt></ruby>
                  。</div>
                <button class="btn-rec-small"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>REC</button>
              </div>
              <div class="dialog-content-feedback">
                <div class="feedback-processing" style="display: none;">processing...</div>
                <div class="feedback-detail" style="display: none;">
                  <button type="button" class="close" aria-label="Close"> <span aria-hidden="true">&times;</span> </button>
                  <div class="feedback-detail-ruby">
                    <ruby><rt><span class="text-danger">Xiao3</span></rt></ruby>
                    <ruby><rt><span class="text-danger">niao3</span></rt></ruby>
                    <ruby><rt><span class="text-danger">fei</span>1</rt></ruby>
                    <ruby><rt>ya</rt></ruby>
                    <ruby><rt><span class="text-danger">fei</span>1</rt></ruby>  
                  </div>
                  <div class="feedback-detail-text">
                    <div style="color:#D81159;"><i class="fas fa-hand-point-right"></i>&nbsp;你需要更多练习。</div>
                    <div style="color:#FF9000; display: none;"><i class="fas fa-star"></i>&nbsp;你可以说得更好。</div>
                    <div style="color:#2EC4B6; display: none;"><i class="fas fa-thumbs-up"></i>&nbsp;你说得不错！</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- --> 
        </div>
        <div class="pageBlock" id="page2"> 
          <!-- -->
          <div class="dialog-p">
            <div class="dialog-figure"></div>
            <div class="dialog-content">
              <div class="dialog-content-sentence">
                <div class="dialog-content-text" onClick="PLAY(this, 'https://kids.smartchinese.org/temp/001 我回家了_04_跨頁.mp3');">
                  <button class="btn-play-small"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>PLAY</button>
                  <ruby><rb>你</rb><rt>Nǐ</rt></ruby>
                  <ruby><rb>好</rb><rt>hǎo</rt></ruby>
                  <ruby><rb>。</rb></ruby></div>
                <button class="btn-rec-small"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>REC</button>
              </div>
              <div class="dialog-content-feedback">
                <div class="feedback-processing" style="display: none;">processing...</div>
                <div id="" class="feedback-detail" style="display: none;">
                  <button type="button" class="close" aria-label="Close"> <span aria-hidden="true">&times;</span> </button>
                  <div class="feedback-detail-ruby">
                    <ruby><rt>Ni3</rt></ruby>
                    <ruby><rt>hao<span class="text-danger">3</span></rt></ruby> 
                  </div>
                  <div class="feedback-detail-text">
                    <div style="color:#D81159; display: none;"><i class="fas fa-hand-point-right"></i>&nbsp;你需要更多练习。</div>
                    <div style="color:#FF9000; display: none;"><i class="fas fa-star"></i>&nbsp;你可以说得更好。</div>
                    <div style="color:#2EC4B6;"><i class="fas fa-thumbs-up"></i>&nbsp;你说得不错！</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- --> 
        </div>
        <div class="pageBlock" id="page3"> 
          <!-- -->
          <div class="dialog-p">
            <div class="dialog-figure"></div>
            <div class="dialog-content">
              <div class="dialog-content-sentence">
                <div class="dialog-content-text" onClick="PLAY(this, 'https://kids.smartchinese.org/temp/001 我回家了_05_跨頁.mp3');">
                  <button class="btn-play-small"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>PLAY</button>
                  <ruby><rb>早安</rb><rt>Zǎo‘ān</rt></ruby>
                  <ruby><rb>。</rb></ruby>
                  </div>
                <button class="btn-rec-small"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>REC</button>
              </div>
              <div class="dialog-content-feedback">
                <div class="feedback-processing" style="display: none;">processing...</div>
                <div class="feedback-detail" style="display: none;">
                  <button type="button" class="close" aria-label="Close"> <span aria-hidden="true">&times;</span> </button>
                  <div class="feedback-detail-ruby">
                    <ruby><rt><span class="text-danger">Zao3an</span>1</rt></ruby>
                  </div>
                  <div class="feedback-detail-text">
                    <div style="color:#D81159;"><i class="fas fa-hand-point-right"></i>&nbsp;你需要更多练习。</div>
                    <div style="color:#FF9000; display: none;"><i class="fas fa-star"></i>&nbsp;你可以说得更好。</div>
                    <div style="color:#2EC4B6; display: none;"><i class="fas fa-thumbs-up"></i>&nbsp;你说得不错！</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- --> 
        </div>
        <div class="pageBlock" id="page4"> 
          <!-- -->
          <div class="dialog-p">
            <div class="dialog-figure"></div>
            <div class="dialog-content">
              <div class="dialog-content-sentence">
                <div class="dialog-content-text" onClick="PLAY(this, 'https://kids.smartchinese.org/temp/001 我回家了_06_跨頁.mp3');">
                  <button class="btn-play-small"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>PLAY</button>
                  <ruby><rb>午安</rb><rt>Wǔ‘ān</rt></ruby>
                  <ruby><rb>。</rb></ruby>
                  </div>
                <button class="btn-rec-small"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>REC</button>
              </div>
              <div class="dialog-content-feedback">
                <div class="feedback-processing" style="display: none;">processing...</div>
                <div class="feedback-detail" style="display: none;">
                  <button type="button" class="close" aria-label="Close"> <span aria-hidden="true">&times;</span> </button>
                  <div class="feedback-detail-ruby">
                    <ruby><rt><span class="text-danger">Wu3an1</span></rt></ruby>
                  </div>
                  <div class="feedback-detail-text">
                    <div style="color:#D81159;"><i class="fas fa-hand-point-right"></i>&nbsp;你需要更多练习。</div>
                    <div style="color:#FF9000; display: none;"><i class="fas fa-star"></i>&nbsp;你可以说得更好。</div>
                    <div style="color:#2EC4B6; display: none;"><i class="fas fa-thumbs-up"></i>&nbsp;你说得不错！</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- --> 
        </div>
        <div class="pageBlock" id="page5"> 
          <!-- -->
          <div class="dialog-p">
            <div class="dialog-figure"></div>
            <div class="dialog-content">
              <div class="dialog-content-sentence">
                <div class="dialog-content-text" onClick="PLAY(this, 'https://kids.smartchinese.org/temp/001 我回家了_07_跨頁.mp3');">
                  <button class="btn-play-small"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>PLAY</button>
                  <ruby><rb>晚安</rb><rt>Wǎn‘ān</rt></ruby>
                  <ruby><rb>。</rb></ruby>
                  </div>
                <button class="btn-rec-small"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>REC</button>
              </div>
              <div class="dialog-content-feedback">
                <div class="feedback-processing" style="display: none;">processing...</div>
                <div id="" class="feedback-detail" style="display: none;">
                  <button type="button" class="close" aria-label="Close"> <span aria-hidden="true">&times;</span> </button>
                  <div class="feedback-detail-ruby">
                    <ruby><rt><span class="text-danger">Wan3an</span>1</rt></ruby>
                  </div>
                  <div class="feedback-detail-text">
                    <div style="color:#D81159; display: none;"><i class="fas fa-hand-point-right"></i>&nbsp;你需要更多练习。</div>
                    <div style="color:#FF9000; display: none;"><i class="fas fa-star"></i>&nbsp;你可以说得更好。</div>
                    <div style="color:#2EC4B6;"><i class="fas fa-thumbs-up"></i>&nbsp;你说得不错！</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- --> 
        </div>
        <div class="pageBlock" id="page6"> 
          <!-- -->
          <div class="dialog-p">
            <div class="dialog-figure"></div>
            <div class="dialog-content">
              <div class="dialog-content-sentence">
                <div class="dialog-content-text" onClick="PLAY(this, 'https://kids.smartchinese.org/temp/001 我回家了_08_跨頁.mp3');">
                  <button class="btn-play-small"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>PLAY</button>
                  <ruby><rb>再</rb><rt>Zài</rt></ruby>
                  <ruby><rb>見</rb><rt>jiàn</rt></ruby>
                  <ruby><rb>。</rb></ruby>
                  </div>
                <button class="btn-rec-small"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>REC</button>
              </div>
              <div class="dialog-content-feedback">
                <div class="feedback-processing" style="display: none;">processing...</div>
                <div class="feedback-detail" style="display: none;">
                  <button type="button" class="close" aria-label="Close"> <span aria-hidden="true">&times;</span> </button>
                  <div class="feedback-detail-ruby">
                    <ruby><rt><span class="text-danger">Zai4</span></rt></ruby>
                    <ruby><rt><span class="text-danger">jian4</span></rt></ruby>
                  </div>
                  <div class="feedback-detail-text">
                    <div style="color:#D81159;"><i class="fas fa-hand-point-right"></i>&nbsp;你需要更多练习。</div>
                    <div style="color:#FF9000; display: none;"><i class="fas fa-star"></i>&nbsp;你可以说得更好。</div>
                    <div style="color:#2EC4B6; display: none;"><i class="fas fa-thumbs-up"></i>&nbsp;你说得不错！</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- --> 
        </div>
        <div class="pageBlock" id="page7"> 
          <!-- -->
          <div class="dialog-p">
            <div class="dialog-figure"></div>
            <div class="dialog-content">
              <div class="dialog-content-sentence">
                <div class="dialog-content-text" onClick="PLAY(this, 'https://kids.smartchinese.org/temp/001 我回家了_09_跨頁.mp3');">
                  <button class="btn-play-small"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>PLAY</button>
                  <ruby><rb>媽</rb><rt>Mā</rt></ruby>
                  <ruby><rb>媽</rb><rt>ma</rt></ruby>
                  ，
                  <ruby><rb>我</rb><rt>wǒ</rt></ruby>
                  <ruby><rb>回</rb><rt>huí</rt></ruby>
                  <ruby><rb>家</rb><rt>jiā</rt></ruby>
                  <ruby><rb>了</rb><rt>le</rt></ruby>
                  。</div>
                <button class="btn-rec-small"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>REC</button>
              </div>
              <div class="dialog-content-feedback">
                <div class="feedback-processing" style="display: none;">processing...</div>
                <div class="feedback-detail" style="display: none;">
                  <button type="button" class="close" aria-label="Close"> <span aria-hidden="true">&times;</span> </button>
                  <div class="feedback-detail-ruby">
                    <ruby><rt>Ma1</rt></ruby>
                    <ruby><rt>ma5</rt></ruby>
                    <ruby><rt><span class="text-danger">wo</span>3</rt></ruby>
                    <ruby><rt><span class="text-danger">hui2</span></rt></ruby>
                    <ruby><rt><span class="text-danger">jia1</span></rt></ruby>
                    <ruby><rt>le5</rt></ruby>
                  </div>
                  <div class="feedback-detail-text">
                    <div style="color:#D81159;"><i class="fas fa-hand-point-right"></i>&nbsp;你需要更多练习。</div>
                    <div style="color:#FF9000; display: none;"><i class="fas fa-star"></i>&nbsp;你可以说得更好。</div>
                    <div style="color:#2EC4B6; display: none;"><i class="fas fa-thumbs-up"></i>&nbsp;你说得不错！</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- --> 
        </div>
        <div class="pageBlock" id="sing"> 
          <!-- -->
          <div class="dialog-p">
            <div class="dialog-figure"></div>
            <div class="dialog-content">
              <div class="dialog-content-sentence">
                <div class="dialog-content-text" onClick="">
                  <button id="play" class="btn-play-small"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>PLAY</button>
                 </div>
              </div>
              <div class="dialog-content-feedback">
                <div class="feedback-processing" style="display: none;">processing...</div>
                <div class="feedback-detail" style="display: none;">
                  <button type="button" class="close" aria-label="Close"> <span aria-hidden="true">&times;</span> </button>
                  <div class="feedback-detail-ruby"> 
                  </div>
                  <div class="feedback-detail-text">
                    <div style="color:#D81159;"><i class="fas fa-hand-point-right"></i>&nbsp;你需要更多练习。</div>
                    <div style="color:#FF9000; display: none;"><i class="fas fa-star"></i>&nbsp;你可以说得更好。</div>
                    <div style="color:#2EC4B6; display: none;"><i class="fas fa-thumbs-up"></i>&nbsp;你说得不错！</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- --> 
        </div>
        <!-- -->
        <div class="pagePagination">
          <div>
            <button type="button" class="btn-gradient" id="PREV"> <span class="glyphicon glyphicon-chevron-left"></span>上一页 </button>
          </div>
          <div>
            <button type="button" class="btn-gradient" id="NEXT"> 下一页 <span class="glyphicon glyphicon-chevron-right"></span> </button>
          </div>
        </div>
        <!-- --> 
      </div>
    </div>
  </div>
  <!-- --> 
</div>

    <audio id="audio">
        <source src="" type="audio/mpeg">
    </audio>

<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<script src="js/jquery.min.js"></script> 
<script src="js/bootstrap.min.js"></script> 
<script src="js/topTool.js"></script> 
<script src="js/achievementStar.js"></script>     
<script>
$(document).ready(function() {
    //call navigation 
    $('.content .navigation').load('_navigation.html',function(){
        //當前頁
        $('.navText').addClass('active');
        
        //demo navigation完成
        $('.navCW').addClass('done');

        //demo stepMenu完成
        $('.stepMenu li:nth-child(1)').addClass('done');
        
        //demo 課文完成
        $(`#page1 .dialog-p:nth-child(1) .btn-play-small,
           #page1 .dialog-p:nth-child(1) .btn-rec-small,
           #page1 .dialog-p:nth-child(2) .btn-play-small,
           #page1 .dialog-p:nth-child(2) .btn-rec-small`).addClass('done');
    }); 
}); 
</script> 
<script>
$(document).ready(function(){
    showPage();

    //demo 依據hash顯示頁數內容
    $(window).on('hashchange', function() {
        showPage();
    });

    // [下一頁]
    $('#NEXT').on('click', function() {
        showNextPage();
    });

    // [上一頁]
    $('#PREV').on('click', function() {
        showPrevPage();
    });
    
    //[PLAY]
    /*$('.dialog-content-text').click(function (e) {//.btn-play-small
        PLAY(this, 'temp/爸爸媽媽早上好.mp3');
    });*/
    
	//[REC] demo
	$('.btn-rec-small').click(function(){
        var $this = $(this);
        
		$this.toggleClass('recording');
		
		if( !$this.hasClass('recording') ){ 
            
			$this.parents('.dialog-p').find('.feedback-processing').show();
            
            setTimeout(function() {
                $this.parents('.dialog-p').find('.feedback-processing').hide();    
                $this.parents('.dialog-p').find('.feedback-detail').show(); 
                
                //星星旋轉 
                rotateStar( $this );
				
                //計算pageBlock星星
                pageStar( $this ); 
				
				//計算navigation星星
				setTimeout(function() {
					navStar();    
				}, 2000); 
            }, 1000);
		}
		
		// close
		$('.feedback-detail .close').click(function(){
			$this.parents('.dialog-p').find('.feedback-processing').hide();    
            $this.parents('.dialog-p').find('.feedback-detail').hide();  
		});
	});
});

//顯示頁內容    
function showPage() {
	var currenthHash = window.location.hash ? window.location.hash : '#page1';
	
	// active stepMenu
	$('.stepMenu ul li a').each(function() {
		if ($(this).attr('href').indexOf(currenthHash) !== -1) {
		  $(this).parents('li').addClass('active').siblings().removeClass('active');
		}
	});
	
	// show currenthHash section
    $(currenthHash).show().siblings('.pageBlock').hide();

    let code = '10101';
    //  current bg
    switch (currenthHash) {
        case '#page1':
            $('.content-body').css('background-image', 'url(images/photo/' + code + '-bg1.jpg)');
            break;
        case '#page2':
            $('.content-body').css('background-image', 'url(images/photo/' + code + '-bg2.jpg)');
            break;
        case '#page3':
            $('.content-body').css('background-image', 'url(images/photo/' + code + '-bg3.jpg)');
            break;
        case '#page4':
            $('.content-body').css('background-image', 'url(images/photo/' + code + '-bg4.jpg)');
            break;
        case '#page5':
            $('.content-body').css('background-image', 'url(images/photo/' + code + '-bg5.jpg)');
            break;
        case '#page6':
            $('.content-body').css('background-image', 'url(images/photo/' + code + '-bg6.jpg)');
            break;
        case '#page7':
            $('.content-body').css('background-image', 'url(images/photo/' + code + '-bg7.jpg)');
            break;    
        case '#sing':
            $('.content-body').css('background-image', 'url(images/photo/' + code + '-bgSing1.jpg), url(images/photo/' + code + '-bgSing2.jpg)');
            break;     
        default:
            $('.content-body').css('background-image', 'url(images/photo/' + code + '-bg.jpg)');
            break;    
    }
    
    if( currenthHash == '#sing' ){ //一起唱class樣式
        $('.content-body').addClass('text-sing'); 
        
        //showKTVspot(code);
        
        $('#play').attr('data-code', code);
        singKTV(code);
    }else{
        $('.content-body').removeClass('text-sing');  
        pauseKTV();
    }
	
    // [上一頁][下一頁]按鈕顯示
    if ( $(currenthHash).index() === 0 ) {
        $("#PREV").hide();
        $("#NEXT").show();
    } else if ( $(currenthHash).index() === $('.pageBlock').length-1 ) {
        $("#PREV").show();
        $("#NEXT").hide();
    } else {
        $("#PREV").show();
        $("#NEXT").show();
    }
}	

// 顯示下一頁內容
function showNextPage() {
	var currenthHash = window.location.hash ? window.location.hash : '#page1';
    
    var currentIndex = $(currenthHash).index();

    var nextPage = $('.pageBlock').eq(currentIndex + 1).attr('id');
    window.location.hash = '#' + nextPage;
}

// 顯示上一頁內容    
function showPrevPage() {
    var currenthHash = window.location.hash ? window.location.hash : '#page1';
    
    var currentIndex = $(currenthHash).index();

    var prevPage = $('.pageBlock').eq(currentIndex - 1).attr('id');
    window.location.hash = '#' + prevPage;
}

var isPlaying = false;
var audio; 
var currentPlaybackTimes = {};    
function PLAY(e, mp3) {
  // 如果是第一次播放或暫停後的再次播放，則創建新的 Audio 物件
  if (!isPlaying || audio.paused) {
    audio = new Audio(mp3);
      
    // 取得當前音檔的當前播放秒數，如果不存在則設為0
    var currentTime = currentPlaybackTimes[mp3] || 0;  
                                   
    audio.currentTime = currentTime;                            
    audio.play();
                                   
    isPlaying = true;
                                   
    $(e).find("button").removeClass("btn-play-small").addClass("btn-pause-small");
  } else {
    audio.pause();  // 暫停當前音檔
    isPlaying = false;
          
    currentPlaybackTimes[mp3] = audio.currentTime;
      
    $(e).find("button").removeClass("btn-pause-small").addClass("btn-play-small");
  }
    
  audio.addEventListener('ended', function () {
    isPlaying = false;
      
    currentPlaybackTime = {}; 
      
    //結束播放移除閃爍效果
    $(e).find("button").removeClass("btn-pause-small").addClass("btn-play-small");
      
    //星星旋轉 
    rotateStar( $(e).find(".btn-play-small") );
	  
    //計算pageBlock星星
    pageStar( $(e).find(".btn-play-small") ); 
	  
	//計算navigation星星
	setTimeout(function() {
		navStar();    
	}, 2000);    
  });
}
 
//一起唱KTV    
function singKTV(val){
     $('.content-body.text-sing .textSection #sing').append(`<div class="sing-left"></div><div class="sing-right"></div>`);   
    
    
     //$.getJSON('json/singKTV-'+ val +'.json', function (data) {
     //    if (data.left && data.left.length > 0) {
     //        $.each(data.left, function(i, item) {
     //           var $div = $('<div class="sing-spot"></div>')
     //               .attr('data-pinyin', item.pinyin)
     //               .css({
     //                   'top': item.top,  
     //                   'left': item.left,
     //               });
     //           $('.sing-left').append($div);
     //        });
     //    }

     //    if (data.right && data.right.length > 0) {
     //        $.each(data.right, function(i, item) {
     //           var $div = $('<div class="sing-spot"></div>')
     //               .attr('data-pinyin', item.pinyin)
     //               .css({
     //                   'top': item.top,  
     //                   'left': item.left,
     //               });
     //           $('.sing-right').append($div);
     //        });
     //    }
     //})

    $.getJSON("json/singKTV-" + val + ".json", function (data) {
        epubInfo = data;
    });
}

    let epubInfo;
    let myReq;
    let n = 0;

    function playAudio(path) {
        let audio = document.getElementById("audio");
        audio.pause();
        audio.muted = false;
        audio.src = path;
        audio.load();
        audio.oncanplaythrough = function () {
            audio.play();
        };
    }

    function stopAudio() {
        let audio = document.getElementById("audio");
        audio.pause();
        audio.currentTime = 0;
        audio.muted = true;
        audio.onended = function () {
        };
    }

    function getCurrentTime() {
        let audio = document.getElementById("audio");
        return audio.currentTime;
    }

    function startTimer() {
        myReq = requestAnimationFrame(function () {
            animate();
        });
    }

    function stopTimer() {
        cancelAnimationFrame(myReq);
    }

    async function animate() {
        let timestampCount = epubInfo.Timestamp.length;
        let songEndTime    = epubInfo.Timestamp[timestampCount - 1];
        let startTime      = epubInfo.Timestamp[n];
        let endTime        = epubInfo.Timestamp[n + 1];

        let currentTime = getCurrentTime() * 1000; // in milliseconds

        if (currentTime >= startTime && currentTime < endTime) {
            $(".sing-left").empty();
            $(".sing-right").empty();
            if (epubInfo.Pinyin[n] != null) {
                let $div = $("<div class='sing-spot'></div>")
                    .attr("data-pinyin", epubInfo.Pinyin[n])
                    .css({
                        "top":  epubInfo.Top[n],
                        "left": epubInfo.Left[n]
                    });
                if (epubInfo.Position[n] == "left")
                    $(".sing-left").append($div);
                else if (epubInfo.Position[n] == "right")
                    $(".sing-right").append($div);
            }
        }

        // Advance the index
        if (currentTime >= endTime) {
            if (n < timestampCount - 2) {
                n += 1;
            }
        }

        if (currentTime >= songEndTime) {
            $(".sing-left").empty();
            $(".sing-right").empty();
        } else {
            myReq = requestAnimationFrame(function () {
                animate();
            });
        }
    }

    // ********************************************************************************************
    function pauseKTV() {
        let audio = document.getElementById("audio");
        audio.pause();
        audio.muted = true;
        $("#play").removeClass("btn-pause-small").addClass("btn-play-small");
    }

    $("#play").click(function () { 
        $(".sing-left").empty();
        $(".sing-right").empty();

        let path = "https://kids.smartchinese.org/temp/" + $(this).data('code') + "-sing.mp3";
        
        let audio = document.getElementById("audio");

        if (audio.src == "") {
            // Start playback
            audio.pause();
            audio.muted = false;
            audio.src = path;
            audio.load();
            audio.oncanplaythrough = function () {
                n = 0;
                audio.play();
                startTimer();
                $("#play").removeClass("btn-play-small").addClass("btn-pause-small");
            };
            audio.onended = function () {
                $("#play").removeClass("btn-pause-small").addClass("btn-play-small");
                
                //星星旋轉  
                rotateStar( $("#play") );
				
                //計算pageBlock星星
                pageStar( $("#play") ); 
				
				//計算navigation星星
				setTimeout(function() {
					navStar();    
				}, 2000); 
            };
        } else {
            // Playing or paused
            if (audio.paused) {
                audio.muted = false;
                audio.play();
                $("#play").removeClass("btn-play-small").addClass("btn-pause-small");
            } else {
                audio.pause();
                audio.muted = true;
                $("#play").removeClass("btn-pause-small").addClass("btn-play-small");
            }
        }
    });

    
function showKTVspot(code){
    $.getJSON('json/singKTV-'+ code +'.json', function (data) {

         $.each(data.Pinyin, function(i, item) {
            var $div = $('<div class="sing-spot"></div>')
                .attr('data-pinyin', item)
                .css({
                    'top': data.Top[i],  
                    'left': data.Left[i],
                });

            if (data.Position[i] == "left")
                $(".sing-left").append($div);
            else if (data.Position[i] == "right")
                $(".sing-right").append($div);
         });
    });    
}
    
    
</script>
</body>
</html>
